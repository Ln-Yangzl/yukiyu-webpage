# 番剧更新表及番剧详情数据库

### 组员

杨智麟	19300290039

陈家豪	19307130210

## 项目背景

该项目立足于目前各大平台网站的番剧信息较为分散，用户需要辗转多个平台才能获取较为完整的番剧信息的背景下，实现了各大平台网站番剧信息的整合。将各大平台网站的番剧更新信息及番剧详情信息整合制表，展现在我们的网页上。

## 需求分析

### 番剧更新表

系统维护在播新番的当前更新集数，播放地址链接，宣传图，等内容。

番剧更新主要来源于`bilibili`，`ACfun`两个个网站。

所有信息均通过爬虫以及python脚本进行动态维护。

### 番剧详情表

针对每个番剧，提供该番剧的详情信息，包括制作公司，监督，声优等内容。

番剧详情主要来自于萌娘百科。

信息通过爬虫python脚本动态维护

### 用户管理

系统用户分为超级管理员用户和普通管理员用户。

#### 普通管理员

可查看数据库中的内容，可拥有删除、修改、添加番剧信息等权力。

#### 超级管理员

拥有数据库的完全控制权，包括查看所有用户资料，创建新用户，用户授权等操作。

## 数据库物理设计

### 数据库各表简介

#### bangumi_list表

该表是本数据库的核心总表。

该表记录了本数据库的所有番剧目录信息，严格来讲其它表（除了用户表）都是为其提供修饰信息的。

#### bilibili表/acfun表

该表提供了番剧更新的详细信息。

该表提供番剧在对应网站的最新集数，播放地址，更新日期等数据。

#### company制作公司表

该表记录了各大制作公司。

该表提供制作公司的名称和代表作品（还可以添加制作公司的其他信息，由于数据来源较为困难等原因未在本项目中添加）。

#### conduct监督表

该表记录了监督的详细信息。

该表提供监督姓名和代表作品（还可以添加监督个人的其他信息，由于数据来源较为困难等原因未在本项目中添加）。

#### bangumi_cast声优表

该表记录各个番剧的声优。

该表提供番剧id——声优姓名关系，由于声优个人信息数据获取困难，本项目中并未将声优单独列表，而仅仅放于关系表中。

#### user_list用户表

该表记录用户的详细信息。

该表提供用户的用户名，密码（采用`werkzeug.security`中的`generate_password_hash`加密），用户权限等信息。

### 数据库各表间关系

`bangumi_list`表是本数据库的核心总表。

在`bangumi_list`表中的番剧，可在`bilibili`表和`acfun`表中有一条或多条详细信息。

在`bangumi_list`表中的番剧，可在`conduct`监督表中有监督对应。

在`bangumi_list`表中的番剧，可在`company`制作公司中有制作公司对应。

在`bangumi_list`表中的番剧，可在`bangumi_cast`声优表中有多位声优对应。

## 系统功能设计

### 系统后端

#### 数据库数据获取

通过python爬虫从目标网站中获取数据，插入到数据库中。

##### 番剧更新信息插入/更新：

此处以`bilibili`表为例，`acfun`表同理

爬虫负责从B站中爬取当天更新的番剧信息，对于爬虫获取到的每一条信息，执行如下操作：

1. 检查该番剧是否已经存在于`bilibili`表中，若存在，则仅仅更新最新集数和播放链接，结束该条信息的操作，若不存在，则转到第2步
2. 检查该番剧是否存在于`bangumi_list`总表中，若存在，则仅仅在`bilibili`表中插入该番信息，并保证`id`与`bangumi_list`中对应，结束该条信息操作，若不存在，则转到第3步
3. 在`bangumi_list`中插入该新番剧，在`bilibili`表中插入该新番剧，并保证`id`相同。

##### 番剧详细信息的录入：

从萌娘百科中获取番剧的详细信息。

对于每一条信息，若该番剧存在于总表中，则在监督表、制作公司表、声优表中插入相关数据，并建立关系（此处调用存储过程完成）。

